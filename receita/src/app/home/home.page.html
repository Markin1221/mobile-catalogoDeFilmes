<ion-header>
  <ion-toolbar  class="header-custom">
    <ion-title class="titulo-jogo">{{'dgg valoroso' | uppercase}}</ion-title>
    <a href="./page2">Histórico</a>
  </ion-toolbar>
</ion-header>

<ion-content [class.vitoria-bg]="vitoria" class="termo-bg ion-padding">

  
  <div class="bottom-area">
    <h2 class="subtitle">Descubra o Agente Secreto!</h2>

    <div class="letras-container" [appShakeOnError]="derrota && !vitoria">

      @for (letra of agenteSecreto.split(''); track $index) {
        <div
          class="letra"
          [ngClass]="{
            'correta': resultado[$index] === '#1cc7d3',
            'parcial': resultado[$index] === '#142d74',
            'errada': resultado[$index] === '#39334f'
          }"
        >
          {{ letters[$index] || '' }}
        </div>
      }
    </div>



    @if (derrota) {
      <p class="mensagem-status">
          {{ vitoria | statusTentativa:  derrota}}
        </p>
    }
  




  <!-- HISTÓRICO DE TENTATIVAS -->
  @if (tentativas.length > 0) {
    <div class="tentativas-container">
      <h3 class="tentativas-titulo">Seus chutes anteriores:</h3>

      @for (t of tentativas; track $index) {
        <div class="tentativa">
          @for (l of t.letras; track $index) {
            <div
              class="tentativa-letra"
              [ngStyle]="{ 'background-color': t.cores[$index] }"
            >
              {{ l }}
            </div>
          }
        </div>
      }
    </div>
  }




  <!-- TELA DE VITÓRIA -->
  @if (vitoria) {
    <div class="overlay-vitoria">
      <div class="vitoria-box">
        <p class="mensagem-status">
          {{ vitoria | statusTentativa: derrota }}
        </p>

        <p>
          Você descobriu o agente secreto:
          <strong>{{ agenteSecreto }}</strong>
        </p>

        <ion-button expand="block" (click)="buscarAgentes()">
          Novo Desafio
        </ion-button>
      </div>
    </div>
  }



  
  

    <div class="btn-container">
      <ion-button expand="block" color="primary" (click)="buscarAgentes()">
        Buscar Novo Agente
      </ion-button>
    </div>

    @if (!vitoria) {

      <div class="teclado-container">

      @for (row of linhasTeclado; track $index) {
        <div class="key-row">
          @for (key of row; track $index) {
            <div
              class="key"
              [ngStyle]="{ 'background-color': teclado[key] || '#1e1e2f' }"
              (click)="cliqueTecla(key)"
            >
              {{ key }}
            </div>
          }
        </div>
      }

      <div class="key-row">
        <div class="key special" (click)="cliqueTecla('BACKSPACE')">⌫</div>
        <div class="key special" (click)="cliqueTecla('ENTER')">ENTER</div>
      </div>

    </div>
    }
    

  </div>

</ion-content>
